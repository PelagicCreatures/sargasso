<!DOCTYPE html>
<html>

<head>
	<title>Example Sargasso Element w/Data Observing &amp; Template rendering</title>
</head>

<body>
	<h3>Example Sargasso Element w/Data Observing &amp; Template rendering</h3>

	<sargasso-to-do-list></sargasso-to-do-list>

	<script async src="https://unpkg.com/es-module-shims@0.13.1/dist/es-module-shims.js"></script>
	<script type="importmap">
	{
		"imports": {
			"@pelagiccreatures/sargasso": "/dist/sargasso.mjs"
		}
	}
	</script>
	<script type="module">
		import { Sargasso, ObservableObject, utils } from "@pelagiccreatures/sargasso"
		import {
			html,render
		} from 'https://unpkg.com/lit-html?module'

		// set up an ObservableObject with the id "todo"
		let todo = {
			list: [
			]
		};

		window.todo = new ObservableObject("todo", todo).data;

		// define MyClass as a subclass of Sargasso
		// sargasso will render the template whenever data in
		// ObservableObject "todo" is changed
		class ToDoList extends Sargasso {
			constructor(element, options = {}) {
				super(element, options)

				// hook up observable data
				this.setTemplateArgs(window.todo);

				// define lit html template.
				let template = (args) => html`
					<strong>Look! A ToDo List!</strong>
					<ul>
						${args.list.map((item) => html`<li data-index=${item.id}><input type="checkbox" name=${item.id}> ${item.name}</li>`)}
					</ul>
					<input type="text" id="new" placeholder="add to list" autofocus> <input type="submit" value="add">
				`;

				this.setRenderer(render); // set lit-html render() as the renderer
				this.setTemplate(template); // set template function

				this.count = 0
			}

			start() {
				super.start();

				this.observableStart("todo")

				this.on("click", '[type="checkbox"]', e => {
					let todo = this.getObservableData("todo");
					let id = parseInt(e.target.getAttribute('name'))
					for(let i = 0; i < todo.list.length; i++) {
						const item = todo.list[i]
						if(item.id === id) {
							todo.list.splice(i, 1);
							break
						}
					}
				})

				// hook up form submitter to add item to list
				this.on("click", '[type="submit"]', e => {
					let inp = this.element.querySelector("#new");
					if(inp.value) {
						let name = inp.value;
						inp.value = "";

						let todo = this.getObservableData("todo");

						window.todo.list.push({
							id: ++this.count,
							done: false,
							name: name
						});
					}
				});
			}
		}

		// Register MyClass to the Sargasso framework
		utils.registerSargassoClass("ToDoList", ToDoList);

		window.onload = () => {
			// Start Sargasso
			utils.bootSargasso();
		}
	</script>
</body>

</html>
